{%extends "base.html"%}
{%block head%}
  <title>Cart</title>
{%endblock%}

{%block content%}
    <div style = "padding:30px; padding-top:80px;">
        <h2 class= "display-4"> Carrito de compras {{request.user.email}}</h2>
        {%if error%}
            <p class = "alert alert-danger">{{error}}</p>
        {%elif cart%}
            <p class = "alert alert-warning">Accede para modificar tallas y colores</p>
            <form action = "{%url "payment"%}" method = "POST">
                {%csrf_token%}
                <div class="container">
                    <div class="row justify-content-center"> 
                        <div class="col-lg-8 align-self-center">
                            <div class="card-body" style = "padding:0px;">
                                <!--Artículos-->
                                {%for product in cart%}
                                    <div class="card-body">
                                        <div class="card">
                                            <h5 class="card-header">{{product.name}} </h5>
                                            <div class="card-body">
                                                <figure class="text-end">
                                                    <img src="{{product.image1.url}}" class="rounded float-start" alt="..." style = "width:100px;">
                                                    <blockquote class="blockquote" style = "margin-bottom:0px;">
                                                    <div class="container">
                                                        <div class="row justify-content-end">
                                                            <div class="col-3">
                                                                <select class="form-select" disabled aria-label=".form-select-lg example" required = "true" name ="!*-size-{{product.ide}}-{{forloop.counter0}}">
                                                                    <option selected disabled>Talla</option>
                                                                    {%for size in product.get_sizes%}
                                                                        <option value="{{size}}" disabled>{{size}}</option>
                                                                    {%endfor%}   
                                                                </select>
                                                            </div>
                                                            <div class="col-3">
                                                                <select class="form-select" disabled aria-label=".form-select-lg example" required = "true" name ="!*-col-{{product.ide}}-{{forloop.counter0}}">
                                                                    <option selected disabled>Color</option>
                                                                    {%for color in product.get_colors%}
                                                                        <option value="{{size}}" disabled>{{color}}</option>
                                                                    {%endfor%}
                                                                </select>
                                                            </div>
                                                        
                                                        </div>
                                                    </div>
                                                    <h4 style = "padding-top:30px;">$MXN{{product.price}}</h4>
                                                    <a href="{{product.get_remove_path}}">Eliminar</a>
                                                    <a href="" style="text-decoration:none">//</a>
                                                    <a href="">Agregar a la WishList</a>
                                                    </blockquote>
                                                </figure>
                                            </div>
                                        </div>
                                    </div>
                                {%endfor%}
                                <!--Artículos-->
                            </div>
        
                        </div>
                        <div class="col-lg-4" style="padding: 1rem;">
                            <div class="card text-center">
                                <div class="card-body">
                                <h5 class="card-title">SUBTOTAL: </h5>
                                <p class="h4">$MXN{{request.session.subtotal_}}</p>
                                <a class="btn btn-primary btn-lg" href= "{% url "login"%}?next={%url "cart"%}">Acceder</a>
                                </div>
                                <div class="card-footer text-muted">
                                Resumen del pedido
                                </div>
                            </div>
                        </div>
                    </div>
                </div> 
            </form>
        {%elif productscart%}
            <!-- <form action = "{%url "payment"%}" method = "POST"> -->
                
                <div class="container">
                    <div class="row justify-content-center"> 
                        <div class="col-lg-8 align-self-center">
                            <div class="card-body" style = "padding:0px;">
                                <!--Artículos-->
                                {%for productcart in productscart%}
                                    <div class="card-body">
                                        <div class="card">
                                            <a href="{{productcart.product.get_product_path}}" style = "text-decoration: none; color: #6c757d;">
                                                <h5 class="card-header">{{productcart.product.name}}</h5>
                                            </a>
                                            <div class="card-body">
                                                <figure class="text-end">
                                                    <a href="{{productcart.product.get_product_path}}">
                                                        <img src="{{productcart.product.image1.url}}" class="rounded float-start" alt="..." style = "width:100px;">
                                                    </a>
                                                    <blockquote class="blockquote" style = "margin-bottom:0px;">
                                                    <div class="container">
                                                        <div class="row justify-content-end">
                                                            <div class="col-sm-4 col-md-3" style = "padding:0px; padding-left:10px;">
                                                                <form action = "option/{{productcart.ide}}" method = "POST"> 
                                                                    {%csrf_token%}
                                                                    {%if  productcart.product.stock == 0 %}
                                                                        <select class="form-select" onchange="this.form.submit()" aria-label=".form-select-lg example" disabled required = "true" name ="size">
                                                                    {%else%}
                                                                        <select class="form-select" onchange="this.form.submit()"  aria-label=".form-select-lg example" required = "true" name ="size">
                                                                    {%endif%}
                                                                            <option disabled = "true" selected>Talla</option>
                                                                        {% for spec in productcart.product.get_specs %}
                                                                            {%if spec.size.valor == productcart.talla%}
                                                                                <option value="{{spec.size.valor}}" selected>{{spec.size.valor}}</option>
                                                                            {%else%}
                                                                                <option value="{{spec.size.valor}}">{{spec.size.valor}}</option>
                                                                            {%endif%}
                                                                        {%endfor%}   
                                                                    </select>
                                                                </form>
                                                            </div>
                                                            <div class="col-sm-5 col-md-4" style = "padding:0px; padding-left:10px;" >
                                                                <form action = "option/{{productcart.ide}}" method = "POST"> 
                                                                    {%csrf_token%}
                                                                    {%if  productcart.product.stock == 0 %}
                                                                        <select class="form-select" onchange="this.form.submit()" aria-label=".form-select-lg example" disabled required = "true" name ="color">
                                                                    {%else%}
                                                                        <select class="form-select" onchange="this.form.submit()" aria-label=".form-select-lg example" required = "true" name ="color">
                                                                    {%endif%}
                                                                            <option disabled = "true" selected>Color</option>
                                                                            {%for spec in productcart.product.get_specs%}
                                                                                {%if spec.color.nombre == productcart.color%}
                                                                                    <option value="{{spec.color.nombre}}" selected>{{spec.color.nombre}}</option>
                                                                                {%else%}
                                                                                    <option value="{{spec.color.nombre}}">{{spec.color.nombre}}</option>
                                                                                {%endif%}    
                                                                            {%endfor%}
                                                                         </select>
                                                                </form>
                                                            </div>
                                                            <div class="col-sm-2 col-md-2" style = "padding:0px; padding-left:10px;" >
                                                                <form action = "option/{{productcart.ide}}" method = "POST"> 
                                                                    {%csrf_token%}
                                                                    <input value = "{{productcart.quantity}}" onKeyDown="return false" onchange="this.form.submit()" min = "1" max ="{{productcart.get_stock}}" type="number" step  ="1" class="form-control" id="cantidad" placeholder="Cantidad" name = "quantity">
                                                                </form>
                                                            </div>

                                                        
                                                        </div>
                                                    </div>
                                                    <h4 style = "padding-top:30px;">$MXN{{productcart.product.price}}</h4>
                                                    <a href="{{productcart.get_remove_path}}" style = "padding-top:10px;">Eliminar</a>
                                                    <!-- <a href="" style="text-decoration:none">//</a>
                                                    <a href="">Agregar a la WishList</a> -->
                                                    </blockquote>
                                                </figure>
                                            </div>
                                        </div>
                                    </div>
                                {%endfor%}
                                <!--Artículos-->
                            </div>
        
                        </div>
                        <div class="col-lg-4" style="padding:1rem; ">
                            <div class="sticky-top">
                                <h3 style = "padding-bottom:1.5rem;"> Resumen del pedido </h3>
                                <div class="card text-center">
                                    <div class="card-body">
                                    <h5 class="card-title">SUBTOTAL: </h5>
                                    <p class="h4">$MXN{{request.user.cart.subtotal}}</p>
                                    <button href="#" class="btn btn-primary btn-lg" type = submit>PAGAR</button>
                                    </div>
                                    <div class="card-footer text-muted">
                                    Resumen del pedido
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> 
            <!-- </form> -->
        {%endif%}
    </div>
    <script>

        window.addEventListener('scroll',function() {
            //When scroll change, you save it on localStorage.
            localStorage.setItem('scrollPosition',window.scrollY);
        },false);
        window.addEventListener('load',function() {
            if(localStorage.getItem('scrollPosition') !== null)
            window.scrollTo(0, localStorage.getItem('scrollPosition'));
        },false);
        
    </script>
{%endblock%}